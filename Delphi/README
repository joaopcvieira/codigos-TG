# Sistema DEMATEL-Delphi com LLM ğŸš€

Sistema avanÃ§ado que combina a metodologia **DEMATEL** (Decision Making Trial and Evaluation Laboratory) com o processo de auditoria **Delphi** para anÃ¡lise de influÃªncia entre fatores em projetos de engenharia aeroespacial. Utiliza **Large Language Models (LLM)** para automatizar a construÃ§Ã£o de matrizes de influÃªncia e implementa um processo de validaÃ§Ã£o baseado no consenso de especialistas.

## ğŸ¯ Objetivo

O sistema foi desenvolvido para analisar as relaÃ§Ãµes de influÃªncia entre fatores crÃ­ticos no desenvolvimento de **motores de foguetes a propelente hÃ­brido**, automatizando o processo tradicionalmente manual de construÃ§Ã£o de matrizes DEMATEL atravÃ©s de LLMs e validando os resultados com dados de especialistas.

## âœ¨ Funcionalidades Principais

### ğŸ§  AvaliaÃ§Ã£o Inteligente com LLM
- **AvaliaÃ§Ãµes automatizadas**: LLM avalia influÃªncia entre pares de fatores (escala 0-9)
- **Justificativas detalhadas**: Cada avaliaÃ§Ã£o inclui fundamentaÃ§Ã£o tÃ©cnica
- **NÃ­veis de confianÃ§a**: Sistema registra confianÃ§a do LLM (escala 1-5)
- **MÃºltiplos provedores**: Suporte para OpenAI GPT-4 e Google Gemini

### ğŸ” Processo de Auditoria Delphi
- **Consenso de especialistas**: Agrega avaliaÃ§Ãµes de mÃºltiplos especialistas
- **Rodadas de reavaliaÃ§Ã£o**: LLM pode revisar suas avaliaÃ§Ãµes considerando o consenso
- **Controle de viÃ©s**: Prompts especializados previnem conformidade cega
- **TransparÃªncia total**: HistÃ³rico completo de mudanÃ§as e justificativas

### ğŸ“Š AnÃ¡lise DEMATEL Completa
- **Matriz de relaÃ§Ã£o direta**: ConstruÃ§Ã£o automatizada da matriz A
- **Matriz de relaÃ§Ã£o total**: CÃ¡lculo da matriz T considerando efeitos indiretos
- **Ãndices de centralidade**: CÃ¡lculo de R (influÃªncia exercida) e C (influÃªncia recebida)
- **VisualizaÃ§Ãµes**: Grafos de rede e diagramas de influÃªncia interativos

### ğŸ›ï¸ Sistema de Cache Inteligente
- **Cache granular**: Controle por rodada para economizar custos de API
- **GestÃ£o flexÃ­vel**: OpÃ§Ã£o de usar cache ou fazer novas consultas
- **PersistÃªncia**: Armazenamento automÃ¡tico de resultados para auditoria posterior

## ğŸ“ Estrutura do Projeto

```
Delphi/
â”œâ”€â”€ ğŸ”§ Arquivos Principais
â”‚   â”œâ”€â”€ delphi_dematel.py      # ImplementaÃ§Ã£o principal do sistema
â”‚   â”œâ”€â”€ config.py              # ConfiguraÃ§Ãµes centralizadas
â”‚   â”œâ”€â”€ example_delphi_usage.py # Exemplo completo de uso
â”‚   â””â”€â”€ main.py                # Sistema DEMATEL bÃ¡sico original
â”‚
â”œâ”€â”€ ğŸ“Š Dados de Entrada
â”‚   â”œâ”€â”€ inputs/
â”‚   â”‚   â”œâ”€â”€ Fatores.csv           # Lista de fatores e descriÃ§Ãµes
â”‚   â”‚   â”œâ”€â”€ expert_responses.csv  # AvaliaÃ§Ãµes dos especialistas
â”‚   â”‚   â””â”€â”€ relacao_fatores.csv   # RestriÃ§Ãµes de influÃªncia
â”‚
â”œâ”€â”€ ğŸ“ˆ Resultados
â”‚   â”œâ”€â”€ Matrizes/                 # Matrizes DEMATEL de cada rodada
â”‚   â”œâ”€â”€ delphi_memory.json        # HistÃ³rico completo do processo
â”‚   â”œâ”€â”€ audit_report.json         # RelatÃ³rio de auditoria detalhado
â”‚   â””â”€â”€ llm_results_cache.json    # Cache de resultados LLM
â”‚
â”œâ”€â”€ ğŸ§ª Testes e Notebooks
â”‚   â”œâ”€â”€ Test/                     # Testes unitÃ¡rios
â”‚   â””â”€â”€ Notebooks/                # AnÃ¡lises exploratÃ³rias
â”‚
â””â”€â”€ ğŸ“š DocumentaÃ§Ã£o
    â”œâ”€â”€ README_Delphi.md         # DocumentaÃ§Ã£o tÃ©cnica detalhada
    â”œâ”€â”€ FORMATO_ESPECIALISTAS.md # Formato dos dados de entrada
    â””â”€â”€ RESUMO_IMPLEMENTACAO.md  # Resumo das implementaÃ§Ãµes
```

## ğŸš€ InstalaÃ§Ã£o e ConfiguraÃ§Ã£o

### 1. PrÃ©-requisitos

```bash
# Python 3.8+
pip install openai numpy pandas networkx plotly scipy python-dotenv matplotlib

# Opcional: Google Gemini
pip install google-generativeai
```

### 2. ConfiguraÃ§Ã£o das APIs

Crie um arquivo `.env` na pasta `Delphi/`:

```bash
# OpenAI (obrigatÃ³rio)
OPENAI_API_KEY=sua_chave_openai_aqui
OPENAI_ORG_ID=sua_organizacao_openai  # opcional

# Google Gemini (opcional)
GEMINI_API_KEY=sua_chave_gemini_aqui

# ConfiguraÃ§Ãµes gerais
LLM_PROVIDER=openai  # ou "gemini"
```

### 3. PreparaÃ§Ã£o dos Dados

#### Arquivo de Fatores (`inputs/Fatores.csv`):
```csv
fator,descricao
DocumentaÃ§Ã£o de Projeto,Grau de detalhamento dos registros tÃ©cnicos
ExperiÃªncia da Equipe,Conhecimento prÃ¡tico da equipe em foguetes hÃ­bridos
Volume da CÃ¢mara,DimensÃµes da cÃ¢mara de combustÃ£o
...
```

#### Arquivo de Especialistas (`inputs/expert_responses.csv`):
```csv
expert_id,factor_source,factor_target,influence_score
1,DocumentaÃ§Ã£o de Projeto,ExperiÃªncia da Equipe,2
1,ExperiÃªncia da Equipe,Volume da CÃ¢mara,3
2,DocumentaÃ§Ã£o de Projeto,ExperiÃªncia da Equipe,1
...
```

> **ğŸ“ Nota**: A escala dos especialistas (0-4) Ã© automaticamente convertida para a escala do LLM (0-9)

## ğŸ’» Como Usar

### ExecuÃ§Ã£o RÃ¡pida - Exemplo Completo

```bash
cd Delphi/
python example_delphi_usage.py
```

### Uso ProgramÃ¡tico

```python
from delphi_dematel import DelphiDematel
import pandas as pd

# 1. Carrega fatores e descriÃ§Ãµes
df_fatores = pd.read_csv('inputs/Fatores.csv')
fatores = df_fatores['fator'].tolist()
descricoes = df_fatores['descricao'].tolist()

# 2. Inicializa o sistema Delphi
delphi_system = DelphiDematel(
    factors=fatores,
    descriptions=descricoes,
    expert_data_path='inputs/expert_responses.csv',
    memory_path='delphi_memory.json',
    provider='openai'  # ou 'gemini'
)

# 3. Executa processo completo (2-3 rodadas)
results = delphi_system.run_full_delphi_process(max_rounds=2)

# 4. Gera visualizaÃ§Ãµes
delphi_system.plot_network(title="Rede de InfluÃªncia - Processo Delphi")

# 5. Analisa mÃ©tricas de concordÃ¢ncia
print(f"CorrelaÃ§Ã£o com especialistas: {results['final_metrics']['spearman_correlation']:.3f}")
print(f"Taxa de acordo: {results['final_metrics']['exact_agreement_rate']*100:.1f}%")
```

### Controle Granular de Cache

O sistema oferece controle detalhado sobre o uso de cache para economizar custos de API:

```python
from example_delphi_usage import run_granular_delphi_process, load_global_cache

# Carrega cache existente
global_cache = load_global_cache()

# Executa com controle granular
results = run_granular_delphi_process(
    delphi_system, 
    global_cache, 
    max_rounds=2
)
```

Durante a execuÃ§Ã£o, vocÃª pode escolher para cada rodada:
- **OpÃ§Ã£o 1**: ğŸ“‚ Usar cache salvo (RECOMENDADO - economiza API)
- **OpÃ§Ã£o 2**: ğŸ†• Fazer novas consultas ao LLM

## ğŸ“Š Resultados e AnÃ¡lises

### Arquivos de SaÃ­da

1. **`delphi_memory.json`**: HistÃ³rico completo com justificativas
2. **`audit_report.json`**: MÃ©tricas detalhadas de concordÃ¢ncia
3. **`matriz_dematel_inicial.txt`**: Matriz da rodada inicial
4. **`matriz_dematel_round_N.txt`**: Matrizes das rodadas subsequentes

### MÃ©tricas de Qualidade

```
RESULTADOS DO PROCESSO DELPHI
==================================================
Rodadas executadas: 3

MÃ©tricas de concordÃ¢ncia com especialistas:
- DiferenÃ§a absoluta mÃ©dia: 1.234
- CorrelaÃ§Ã£o de Spearman: 0.756
- Taxa de acordo exato: 23.4%
- Taxa de acordo prÃ³ximo (Â±1): 67.8%

Resumo das mudanÃ§as:
- Pares que mudaram: 12/132 (9.1%)
- Desacordos significativos: 5

Maiores desacordos (diferenÃ§a > 2 pontos):
- Temperatura â†’ PressÃ£o: LLM=8, Especialistas=5.5
- Geometria â†’ Empuxo: LLM=3, Especialistas=6.0
```

### VisualizaÃ§Ãµes Geradas

- **Grafo de rede**: VisualizaÃ§Ã£o das relaÃ§Ãµes de influÃªncia
- **Diagrama de dispersÃ£o**: R vs C (causador vs receptor)
- **Matriz de calor**: Intensidades das relaÃ§Ãµes
- **AnÃ¡lise temporal**: EvoluÃ§Ã£o das avaliaÃ§Ãµes por rodada

## ğŸ”¬ Processo Delphi Detalhado

### Rodada Inicial
1. **AvaliaÃ§Ã£o primÃ¡ria**: LLM avalia cada par (i,j) com justificativa
2. **Registro de confianÃ§a**: Sistema armazena nÃ­vel de confianÃ§a (1-5)
3. **ConstruÃ§Ã£o da matriz**: Matriz DEMATEL inicial Ã© formada

### Rodadas de Auditoria
1. **ApresentaÃ§Ã£o do consenso**: LLM vÃª estatÃ­sticas dos especialistas
2. **Prompt de autonomia**: InstruÃ§Ãµes explÃ­citas para manter independÃªncia
3. **ReavaliaÃ§Ã£o fundamentada**: LLM pode alterar apenas com justificativa tÃ©cnica
4. **Registro de mudanÃ§as**: Sistema documenta alteraÃ§Ãµes e motivos

### Template do Prompt de Auditoria

```
ğŸ” AUDITORIA DELPHI - REAVALIAÃ‡ÃƒO

SUA AVALIAÃ‡ÃƒO ANTERIOR:
- Nota: 7/9
- Justificativa: "Temperatura afeta diretamente a pressÃ£o..."
- ConfianÃ§a: 4/5

ğŸ“Š CONSENSO DOS ESPECIALISTAS:
- Mediana: 5.0/9
- Intervalo Q1-Q3: 4.0 - 6.5
- Baseado em 15 especialistas

âš–ï¸ INSTRUÃ‡ÃƒO CRÃTICA:
Mantenha sua AUTONOMIA TÃ‰CNICA. NÃ£o mude apenas para 
seguir a maioria. Altere SOMENTE se houver motivo 
tÃ©cnico substantivo baseado em evidÃªncias.
```

## ğŸ›¡ï¸ Controle de ViÃ©s e Qualidade

### Medidas Anti-ViÃ©s Implementadas

1. **Prompts de autonomia**: InstruÃ§Ãµes explÃ­citas contra conformidade
2. **Justificativas obrigatÃ³rias**: MudanÃ§as requerem fundamentaÃ§Ã£o tÃ©cnica
3. **Registro de divergÃªncias**: Sistema identifica e documenta desacordos
4. **AnÃ¡lise de confianÃ§a**: CorrelaÃ§Ã£o entre confianÃ§a e mudanÃ§as

### ValidaÃ§Ã£o de Qualidade

- **Testes unitÃ¡rios**: Cobertura completa das funcionalidades
- **ValidaÃ§Ã£o cruzada**: ComparaÃ§Ã£o com dados reais de especialistas
- **Reprodutibilidade**: Pipeline determinÃ­stico e auditÃ¡vel
- **DocumentaÃ§Ã£o**: Processo completamente transparente

## ğŸ§ª Testes e Desenvolvimento

### Executar Testes

```bash
# Testes bÃ¡sicos
python Test/test_delphi_basic.py

# Testes de conversÃ£o de escala
python Test/test_scale_conversion.py

# AnÃ¡lise completa (requer dados)
python example_delphi_usage.py
```

### Estrutura de Testes

```python
# Exemplo de teste unitÃ¡rio
def test_expert_aggregation():
    # Testa agregaÃ§Ã£o de dados de especialistas
    expert_data = [[1,2,3], [2,3,4], [1,3,4]]
    stats = ExpertAggregator.aggregate_expert_responses(expert_data)
    assert stats[(0,1)].median == 2.0
    assert stats[(0,1)].iqr == 1.0
```

## âš™ï¸ ConfiguraÃ§Ãµes AvanÃ§adas

### PersonalizaÃ§Ã£o de Prompts

```python
# Prompt customizado para domÃ­nio especÃ­fico
custom_prompt = """
VocÃª Ã© um especialista em {domain}.
Considere o contexto de {context}.
Avalie a influÃªncia de {src} em {tgt}...
"""

delphi_system = DelphiDematel(
    factors=fatores,
    descriptions=descricoes,
    prompt_tmpl=custom_prompt
)
```

### ConfiguraÃ§Ãµes de Provider

```python
# OpenAI com configuraÃ§Ãµes especÃ­ficas
delphi_system = DelphiDematel(
    factors=fatores,
    descriptions=descricoes,
    provider='openai',
    model='gpt-4',  # Modelo especÃ­fico
    api_key='sk-...'  # Chave especÃ­fica
)

# Gemini como alternativa
delphi_system = DelphiDematel(
    factors=fatores,
    descriptions=descricoes,
    provider='gemini',
    model='gemini-pro'
)
```

## ğŸ“ˆ Casos de Uso

### 1. Engenharia Aeroespacial
- AnÃ¡lise de fatores crÃ­ticos em motores de foguete
- IdentificaÃ§Ã£o de dependÃªncias em sistemas propulsivos
- OtimizaÃ§Ã£o de parÃ¢metros de projeto

### 2. GestÃ£o de Projetos
- AnÃ¡lise de riscos e dependÃªncias
- IdentificaÃ§Ã£o de fatores crÃ­ticos de sucesso
- Planejamento de recursos e cronograma

### 3. AnÃ¡lise de Sistemas Complexos
- Estudos de causa-efeito em sistemas industriais
- AnÃ¡lise de impacto em processos organizacionais
- IdentificaÃ§Ã£o de gargalos e oportunidades

## ğŸ”® Desenvolvimentos Futuros

### Funcionalidades Planejadas
- **MÃºltiplos LLMs**: ComparaÃ§Ã£o entre diferentes modelos
- **Pesos adaptativos**: Especialistas com maior concordÃ¢ncia tÃªm mais peso
- **Interface grÃ¡fica**: Dashboard web para execuÃ§Ã£o e anÃ¡lise
- **API REST**: Endpoint para integraÃ§Ã£o com outros sistemas

### Melhorias de Algoritmo
- **ConvergÃªncia automÃ¡tica**: Parada quando consenso Ã© atingido
- **AnÃ¡lise de sensibilidade**: Impacto de mudanÃ§as individuais
- **Bootstrap estatÃ­stico**: Intervalos de confianÃ§a para mÃ©tricas
- **AnÃ¡lise temporal**: EvoluÃ§Ã£o de consenso ao longo do tempo

## ğŸ¤ ContribuiÃ§Ãµes

Este projeto faz parte de um Trabalho de GraduaÃ§Ã£o em Engenharia Aeroespacial. ContribuiÃ§Ãµes sÃ£o bem-vindas!

### Como Contribuir
1. Fork o projeto
2. Crie uma branch (`git checkout -b feature/nova-funcionalidade`)
3. Commit suas mudanÃ§as (`git commit -am 'Adiciona nova funcionalidade'`)
4. Push para a branch (`git push origin feature/nova-funcionalidade`)
5. Abra um Pull Request

### Ãreas de ContribuiÃ§Ã£o
- ğŸ§ª Novos casos de teste
- ğŸ“Š Algoritmos de visualizaÃ§Ã£o
- ğŸ”§ OtimizaÃ§Ãµes de performance
- ğŸ“š DocumentaÃ§Ã£o e exemplos
- ğŸŒ Suporte a novos provedores LLM

## ğŸ“„ LicenÃ§a

Este projeto estÃ¡ sob a licenÃ§a MIT. Veja o arquivo `LICENSE` para mais detalhes.

## ğŸ“ Contato e Suporte

- **Desenvolvedor**: JoÃ£o Paulo Vieira
- **InstituiÃ§Ã£o**: Engenharia Aeroespacial
- **Projeto**: Trabalho de GraduaÃ§Ã£o - AnÃ¡lise DEMATEL com LLM

Para questÃµes tÃ©cnicas, abra uma issue no repositÃ³rio GitHub.

---

**ğŸ“š DocumentaÃ§Ã£o Adicional:**
- [`README_Delphi.md`](README_Delphi.md) - DocumentaÃ§Ã£o tÃ©cnica detalhada
- [`FORMATO_ESPECIALISTAS.md`](FORMATO_ESPECIALISTAS.md) - Formato dos dados
- [`RESUMO_IMPLEMENTACAO.md`](RESUMO_IMPLEMENTACAO.md) - Detalhes de implementaÃ§Ã£o

**ğŸ¯ Status do Projeto:** âœ… **Totalmente funcional e pronto para produÃ§Ã£o**